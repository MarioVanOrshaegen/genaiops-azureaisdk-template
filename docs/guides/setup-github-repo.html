<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Repository Setup - Project Documentation</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
</head>
<body>
    <header>
        <div class="project-name">GenAIOps with AI Foundry</div>
    </header>

    <div class="sidebar">
        <nav>
            <ul class="nav-list">
                <li><a href="../index.html">Home</a></li>
                <li><a href="getting-started.html">Getting Started</a></li>
                <li><a href="setup-cloud-infra.html">Cloud Infrastructure Setup</a></li>
                <li><a href="local-setup-conda.html">Local Setup</a></li>
                <li><a href="local-setup-uv.html">Local Setup</a></li>
                <li><a href="setup-github-repo.html">GitHub Setup</a></li>
            </ul>
        </nav>
    </div>

    <main class="main-content">
        <h1>GitHub Repository Setup Guide</h1>
        
        <h2>Prerequisites</h2>
        <ul>
            <li>Azure CLI installed and configured</li>
            <li>GitHub account with repository access</li>
            <li>Azure subscription with appropriate permissions</li>
        </ul>

        <h2>1. Service Principal Creation</h2>
        <p>Create a service principal in Azure Entra ID:</p>
        <pre><code class="language-bash"># Login to Azure
az login

# Create service principal and use output
az ad sp create-for-rbac --name "your-sp-name" --role contributor \
    --scopes /subscriptions/your-subscription-id \
    --sdk-auth

# These credentials are used as Github environment secrets to access 
# Azure resources and services from Github workflows
</code></pre>

        <p>The output should look like:</p>
        <pre><code class="language-json">{
    "clientId": "xxx",
    "clientSecret": "xxxx",
    "subscriptionId": "xxxx",
    "tenantId": "xxxx"
}</code></pre>

        <h2>2. GitHub Environments Setup</h2>
        <p>Create the following environments in your GitHub repository:</p>
        <ol>
            <li>Go to your repository settings</li>
            <li>Navigate to Environments</li>
            <li>Create environments for:
                <ul>
                    <li>pr (Pull Request)</li>
                    <li>dev (Development)</li>
                    <li>any other needed environment</li>
                </ul>
            </li>
        </ol>

        <h3>Environment Variables</h3>
        <p>For each environment, set these variables (based on your .env file):</p>
        <pre><code class="language-yaml"># Required for all environments
AZURE_CREDENTIALS: |
    {
        "clientId": "xxx",
        "clientSecret": "xxxx",
        "subscriptionId": "xxxx",
        "tenantId": "xxxx"
    }

# OpenAI Configuration
AZURE_OPENAI_API_VERSION: "2024-02-01"
AZURE_AI_CHAT_ENDPOINT: "https://your-instance.openai.azure.com/"
AZURE_AI_CHAT_KEY: "your-chat-key"
AOAI_API_KEY: "your-api-key"
GPT4O_DEPLOYMENT_NAME: "your-deployment"
GPT4O_API_KEY: "your-gpt4-key"

# Project Configuration
SUBSCRIPTION_ID: "your-subscription"
RESOURCE_GROUP_NAME: "your-resource-group"
PROJECT_NAME: "your-project-name"
USER_CLIENT_ID: "your-client-id"
CONNECTION_STRING: "your-connection-string"
PROMPTY_FILE: "prompty.yaml"</code></pre>

        <h2>3. Workflow Configurations</h2>
        
        <h3>PR Workflow (math_coding_pr_workflow.yaml)</h3>
        <p>Triggers on PR to dev or main for specific changes:</p>
        <pre><code class="language-yaml">name: Math Coding PR Workflow

on:
  pull_request:
    branches: [ main, dev ]
    paths:
      - 'math_coding/**'
      - '.github/**'
      - 'llmops/**'

jobs:
  validate:
    uses: ./.github/workflows/platform_pr_dev_workflow.yaml
    with:
      config-file: experiment.pr.yaml
    secrets: inherit</code></pre>

        <h3>CI/CD Workflow (math_coding_ci_dev_workflow.yaml)</h3>
        <p>Executes on PR merge to main or dev:</p>
        <pre><code class="language-yaml">name: Math Coding CI/CD Workflow

on:
  push:
    branches: [ main, dev ]
    paths:
      - 'math_coding/**'
      - '.github/**'
      - 'llmops/**'

jobs:
  evaluate:
    runs-on: ubuntu-latest
    environment: dev
    steps:
      - uses: actions/checkout@v2
      
      - name: Run Evaluation
        run: |
          python -m experiment.run --config experiment.dev.yaml
      
      - name: Deploy Function
        uses: ./.github/workflows/platform_cd_function_deployment.yaml
        with:
          config-file: experiment.dev.yaml
        secrets: inherit</code></pre>

        <h2>4. Workflow Details</h2>

        <h3>PR Validation Workflow</h3>
        <ul>
            <li>Triggered by pull requests to dev or main</li>
            <li>Monitors changes in specific folders</li>
            <li>Uses experiment.pr.yaml for configuration</li>
            <li>Performs:
                <ul>
                    <li>Unit testing</li>
                    <li>Code quality checks</li>
                    <li>Build validation</li>
                </ul>
            </li>
        </ul>

        <h3>CI/CD Development Workflow</h3>
        <ul>
            <li>Triggered on PR merge to dev or main</li>
            <li>Uses environment-specific configuration (experiment.dev.yaml)</li>
            <li>Performs:
                <ul>
                    <li>Evaluation with selected prompts</li>
                    <li>Model configuration testing</li>
                    <li>Logging to AI Foundry project</li>
                    <li>Function deployment</li>
                </ul>
            </li>
        </ul>

        <h2>5. Making Changes</h2>
        <p>To trigger the PR workflow:</p>
        <pre><code class="language-bash"># Create and checkout feature branch
git checkout -b feature/math-enhancement

# Make changes to relevant files
# Example: Update math_coding/flows/math_code_generation/pure_python_flow.py

# Commit and push changes
git add .
git commit -m "Enhanced math coding functionality"
git push origin feature/math-enhancement

# Create PR to dev branch through GitHub interface</code></pre>

        <h2>Best Practices</h2>
        <ul>
            <li>Keep sensitive information in GitHub Secrets</li>
            <li>Use different configuration files for different environments</li>
            <li>Implement proper branch protection rules</li>
            <li>Review workflow logs for debugging</li>
            <li>Maintain clear documentation for custom deployment workflows</li>
        </ul>

        <h2>Troubleshooting</h2>
        <ul>
            <li>Verify service principal permissions</li>
            <li>Check environment variable configuration</li>
            <li>Review GitHub Actions logs for errors</li>
            <li>Ensure branch protection rules don't block workflows</li>
        </ul>
    </main>
</body>
</html>